<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gems Rush: Divine Teams - Epic Match-3 Adventure</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="src/ui/modals.css" />
    <link rel="stylesheet" href="src/ui/settings.css" />
    <meta name="description" content="Join the divine battle in Gems Rush: Divine Teams - an epic match-3 puzzle game with celestial gems and team-based gameplay">
    <meta name="keywords" content="gems rush, divine teams, match3, puzzle, celestial gems, team battle">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon.svg">
    <meta name="theme-color" content="#1a1a3a">
    
    <!-- Preload key resources -->
    <link rel="preload" href="src/main.js" as="script" crossorigin>
<script type="module" src="src/main.js"></script>
  </head>
  <body>
    <!-- GLOBAL HOME BUTTON (appears on all screens except main menu) -->
    <button id="homeButton" class="home-button back-to-menu" 
            aria-label="Return to Main Menu" 
            title="Return to Main Menu"
            tabindex="0">
      <span class="home-icon">ğŸ </span>
    </button>

    <!-- MAIN MENU SCREEN -->
    <main id="mainMenu" class="main-menu" role="main" aria-label="Main Menu">
      <div class="main-menu-content">
        <!-- Animated Background -->
        <div class="menu-background">
          <div class="floating-gems">
            <div class="floating-gem" style="--delay: 0s; --color: #FF4500;">ğŸ”¥</div>
            <div class="floating-gem" style="--delay: 0.5s; --color: #1E90FF;">ğŸ’§</div>
            <div class="floating-gem" style="--delay: 1s; --color: #8B4513;">ğŸŒ</div>
            <div class="floating-gem" style="--delay: 1.5s; --color: #87CEEB;">ğŸ’¨</div>
            <div class="floating-gem" style="--delay: 2s; --color: #FFD700;">âš¡</div>
            <div class="floating-gem" style="--delay: 2.5s; --color: #32CD32;">ğŸŒ¿</div>
            <div class="floating-gem" style="--delay: 3s; --color: #9932CC;">ğŸ”®</div>
          </div>
          <div class="particle-field"></div>
          <div class="divine-aura"></div>
        </div>
        
        <!-- Main Title Hero Section -->
        <div class="menu-hero">
          <div class="hero-content">
            <div class="main-title-container">
              <h1 class="main-title">
                <span class="title-line">âš¡ GEMS RUSH âš¡</span>
                <span class="title-subtitle">DIVINE TEAMS</span>
              </h1>
              <div class="title-effects">
                <div class="divine-glow"></div>
                <div class="power-rings"></div>
              </div>
            </div>
            <p class="main-tagline">Epic Match-3 Adventure â€¢ Divine Powers â€¢ Legendary Battles</p>
            
            <!-- Quick Stats Preview -->
            <div class="hero-stats">
              <div class="stat-preview">
                <span class="stat-icon">ğŸ’</span>
                <span class="stat-text">7 Divine Gems</span>
              </div>
              <div class="stat-preview">
                <span class="stat-icon">ğŸ†</span>
                <span class="stat-text">4 Epic Modes</span>
              </div>
              <div class="stat-preview">
                <span class="stat-icon">âš”ï¸</span>
                <span class="stat-text">Infinite Realms</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Stage Map Layout -->
        <section class="stage-map-section" role="region" aria-labelledby="stage-title">
          <div class="stage-container">
            <!-- Left Side Controls -->
            <div class="left-controls">
              <div class="control-group">
                <button class="control-btn mode-time" aria-label="Time Attack Mode">
                  <div class="btn-icon">â±ï¸</div>
                  <div class="btn-label">Time Attack</div>
                </button>
                <button class="control-btn mode-daily" aria-label="Daily Challenge">
                  <div class="btn-icon">ğŸ“…</div>
                  <div class="btn-label">Daily Quest</div>
                </button>
              </div>
              
              <div class="control-group">
                <button class="control-btn" id="gameGuideBtn" aria-label="Game Guide">
                  <div class="btn-icon">ğŸ“–</div>
                  <div class="btn-label">Guide</div>
                </button>
                <button class="control-btn" id="settingsBtn" aria-label="Settings">
                  <div class="btn-icon">âš™ï¸</div>
                  <div class="btn-label">Settings</div>
                </button>
              </div>
            </div>
            
            <!-- Central Map Area -->
            <div class="stage-map-center">
              <div class="stage-header">
                <h2 id="stage-title" class="stage-title">
                  <span class="stage-number">Stage <span id="currentStageNumber">1</span></span>
                  <span class="stage-type" id="currentStageType">Divine Realm</span>
                </h2>
              </div>
              
              <!-- Square Map Display -->
              <div class="stage-map-display">
                <div class="map-container">
                  <div class="stage-map-visual" id="stageMapVisual">
                    <div class="map-background">
                      <div class="divine-realm-bg"></div>
                      <div class="map-grid"></div>
                      <div class="floating-essence"></div>
                    </div>
                    
                    <!-- Current Stage Indicator -->
                    <div class="current-stage-marker" id="currentStageMarker">
                      <div class="marker-icon">âš¡</div>
                      <div class="marker-glow"></div>
                      <div class="marker-pulse"></div>
                    </div>
                    
                    <!-- Stage Preview Info -->
                    <div class="stage-preview" id="stagePreview">
                      <div class="preview-content">
                        <div class="preview-title" id="previewTitle">Stage 1</div>
                        <div class="preview-target" id="previewTarget">Target: 1,000</div>
                        <div class="preview-type" id="previewType">Normal</div>
                      </div>
                    </div>
                    
                    <!-- Boss Stage Indicator -->
                    <div class="boss-indicator hidden" id="bossIndicator">
                      <div class="boss-crown">ğŸ‘‘</div>
                      <div class="boss-text">BOSS STAGE</div>
                      <div class="boss-effects"></div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Play Button -->
              <div class="play-button-container">
                <button class="play-button" id="playStageBtn" aria-label="Start Current Stage">
                  <div class="play-icon">â–¶ï¸</div>
                  <div class="play-text">PLAY</div>
                  <div class="play-effects"></div>
                </button>
              </div>
            </div>
            
            <!-- Right Side Controls -->
            <div class="right-controls">
              <div class="control-group">
                <!-- Game Mode Selector with slide arrows -->
                <div class="game-mode-selector" id="gameModeSelector">
                  <button class="control-btn mode-selector-btn featured" id="modeSelectorBtn" aria-label="Game Mode Selector" title="Select Game Mode">
                    <div class="mode-arrow-left" id="modeArrowLeft">â—€</div>
                    <div class="mode-content">
                      <div class="mode-icon btn-icon">ğŸ¯</div>
                      <div class="mode-text btn-label">Normal</div>
                    </div>
                    <div class="mode-arrow-right" id="modeArrowRight">â–¶</div>
                    <div class="btn-badge">ACTIVE</div>
                  </button>
                </div>
                <button class="control-btn" id="stageSelectBtn" aria-label="Stage Selection">
                  <div class="btn-icon">ğŸ—ºï¸</div>
                  <div class="btn-label">Map</div>
                </button>
              </div>
              
              <div class="control-group">
                <button class="control-btn" id="creditsBtn" aria-label="Credits">
                  <div class="btn-icon">ğŸ‘¥</div>
                  <div class="btn-label">Credits</div>
                </button>
                <button class="control-btn" id="statsBtn" aria-label="Statistics">
                  <div class="btn-icon">ğŸ“Š</div>
                  <div class="btn-label">Stats</div>
                </button>
              </div>
            </div>
          </div>
          
          <!-- Stage Progress Bar -->
          <div class="stage-progress-section">
            <div class="progress-info">
              <div class="progress-label">Stage Progress</div>
              <div class="progress-stats">
                <span id="completedStages">0</span> / <span id="totalStages">1</span> Completed
              </div>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" id="stageProgressFill" style="width: 0%"></div>
              <div class="progress-glow"></div>
            </div>
            <div class="next-boss-info">
              <span class="boss-countdown">Next Boss: Stage <span id="nextBossStage">5</span></span>
            </div>
          </div>
        </section>
        
        <!-- Enhanced Game Information -->
        <section class="menu-info" role="region" aria-labelledby="about-title">
          <div class="info-container">
            <div class="info-main">
              <div class="info-section">
                <h3 id="about-title">
                  <span class="info-icon">ğŸŒŸ</span>
                  About Divine Teams
                </h3>
                <p>Master the ancient art of divine gem matching! Unite elemental powers, create epic cascades, and build legendary teams to conquer mystical realms. With 7 unique divine gems, each battle is a strategic masterpiece waiting to unfold.</p>
              </div>
              
              <!-- Divine Gems Preview -->
              <div class="gems-preview">
                <h4>ğŸ”® Divine Gem Powers</h4>
                <div class="gems-showcase">
                  <div class="gem-preview fire" title="Fire - Sacred flames of purification">ğŸ”¥</div>
                  <div class="gem-preview water" title="Water - Healing waters of life">ğŸ’§</div>
                  <div class="gem-preview earth" title="Earth - Eternal foundation stone">ğŸŒ</div>
                  <div class="gem-preview air" title="Air - Celestial winds of freedom">ğŸ’¨</div>
                  <div class="gem-preview lightning" title="Lightning - Pure divine energy">âš¡</div>
                  <div class="gem-preview nature" title="Nature - Life force of creation">ğŸŒ¿</div>
                  <div class="gem-preview magic" title="Magic - Infinite mystical potential">ğŸ”®</div>
                </div>
              </div>
            </div>
            
            <!-- Enhanced Features Grid -->
            <div class="info-features">
              <div class="features-grid">
                <div class="feature">
                  <div class="feature-icon">ğŸ”—</div>
                  <div class="feature-content">
                    <span class="feature-title">Epic Cascades</span>
                    <span class="feature-text">Chain reactions multiply your divine power</span>
                  </div>
                </div>
                <div class="feature">
                  <div class="feature-icon">ğŸ†</div>
                  <div class="feature-content">
                    <span class="feature-title">Achievements</span>
                    <span class="feature-text">Unlock divine honors and legendary status</span>
                  </div>
                </div>
                <div class="feature">
                  <div class="feature-icon">ğŸ“Š</div>
                  <div class="feature-content">
                    <span class="feature-title">Progress Tracking</span>
                    <span class="feature-text">Monitor your ascension through the realms</span>
                  </div>
                </div>
                <div class="feature">
                  <div class="feature-icon">âš™ï¸</div>
                  <div class="feature-content">
                    <span class="feature-title">Customization</span>
                    <span class="feature-text">Tailor your divine experience perfectly</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        
        <!-- Enhanced Menu Footer -->
        <footer class="menu-footer" role="contentinfo">
          <div class="footer-content">
            <div class="footer-buttons">
              <button class="footer-btn">
                <span class="footer-icon">ğŸ“–</span>
                <span class="footer-text">Game Guide</span>
              </button>
              <button class="footer-btn">
                <span class="footer-icon">âš™ï¸</span>
                <span class="footer-text">Settings</span>
              </button>
              <button class="footer-btn">
                <span class="footer-icon">ğŸ‘¥</span>
                <span class="footer-text">Credits</span>
              </button>
            </div>
            <div class="footer-version">
              <span>Gems Rush: Divine Teams v1.0</span>
            </div>
          </div>
        </footer>
      </div>
    </main>

    <!-- GAME INTERFACE (Initially Hidden) -->
    <div id="gameInterface" class="game-interface" style="display: none;" role="application" aria-label="Game Interface">
      <!-- NEW: Daily Challenge Badge -->
              <div id="dailyChallengeBadge" class="daily-challenge-badge" style="display: none;">
        ğŸ“… Daily Challenge
      </div>

<!-- NEW: Timer Display (for Time Attack mode) -->
     <div id="timerDisplay" class="timer-display" style="display: none;">
      â° <span id="timerValue">--</span>
     </div>

    <!-- NEW: Streak Counter -->
    <div id="streakCounter" class="streak-counter" style="display: none;">
      ğŸ”¥ Streak: 0
    </div>

    <!-- NEW: Statistics Panel -->
    <div id="statsPanel" class="stats-panel" style="display: none;">
      <h4>ğŸ“Š Game Stats</h4>
      <div class="stat-line">
        <span>Games:</span>
        <span id="statGames">0</span>
      </div>
      <div class="stat-line">
        <span>Best Score:</span>
        <span id="statBestScore">0</span>
      </div>
      <div class="stat-line">
        <span>Total Score:</span>
        <span id="statTotalScore">0</span>
      </div>
      <div class="stat-line">
        <span>Highest Level:</span>
        <span id="statHighestLevel">1</span>
      </div>
      <div class="stat-line">
        <span>Best Streak:</span>
        <span id="statBestStreak">0</span>
      </div>
    </div>

    <div class="game-container">
      <!-- Game Title -->
      <h1 class="game-title">âš¡ Gems Rush: Divine Teams âš¡</h1>
      <p class="game-subtitle">Unite Divine Powers â€¢ Rush for Victory â€¢ Team Dominance</p>
      
      <!-- NEW: Game Mode Indicator -->
      <div id="gameModeIndicator" class="game-mode-indicator" style="display: none;">
        ğŸ¯ Normal Mode
      </div>

      <!-- Game Statistics (will be populated by JavaScript) -->
      <div class="game-stats">
        <!-- Stats will be dynamically created by JavaScript -->
      </div>
      
      <!-- Game Board -->
      <div class="game-board" id="gameBoard">
        <!-- Divine gems will be dynamically generated by JavaScript -->
      </div>
      
      <!-- Game Controls -->
      <div class="game-controls">
        <button class="btn btn-primary" id="restartBtn">
          ğŸ”„ New Battle
        </button>
        <button class="btn btn-secondary" id="gameGuideBtn">
          ğŸ“œ Divine Guide
        </button>
        <!-- NEW: Enhanced controls -->
        <button class="btn btn-hint" id="hintBtn">
          ğŸ’¡ Hint
        </button>
        <button class="btn btn-undo" id="undoBtn">
          â†©ï¸ Undo
        </button>
        <button class="btn btn-settings" id="settingsBtn">
          âš™ï¸ Settings
        </button>
        <button class="btn btn-menu back-to-menu">
          ğŸ  Main Menu
        </button>
      </div>


      
      <!-- Simplified Instructions -->
      <div id="instructions" class="instructions" style="display: none;">
        <h3>âš¡ How to Play Gems Rush: Divine Teams</h3>
        
        <p><strong>ğŸ¯ Divine Battle Rules:</strong></p>
        <ul>
          <li>ğŸ”„ <strong>Swap adjacent gems</strong> to create matches of 3 or more identical divine powers</li>
          <li>ğŸ¯ <strong>Reach target scores</strong> to advance through divine realms</li>
          <li>ğŸ’ <strong>Create bigger matches</strong> for higher scores and divine combo multipliers</li>
          <li>âš¡ <strong>Chain reactions</strong> occur when new gems fall and create more celestial matches</li>
          <li>ğŸ’¡ <strong>Use hints</strong> when stuck - they'll show you possible moves</li>
          <li>â†©ï¸ <strong>Undo moves</strong> if you make a mistake (limited uses)</li>
        </ul>
        
        <p><strong>ğŸ® Game Modes:</strong></p>
        <ul>
          <li>ğŸ¯ <strong>Normal:</strong> Classic gameplay with unlimited time</li>
          <li>â±ï¸ <strong>Time Attack:</strong> Score as much as possible in 60 seconds</li>
          <li>ğŸ“… <strong>Divine Quest:</strong> Special daily divine quests with themed challenges</li>
        </ul>
        
        <p><strong>ğŸŒŸ Divine Gem Powers:</strong></p>
        <ul>
          <li>ğŸ”¥ <strong>Fire:</strong> Blazing divine gem with sacred flames</li>
          <li>ğŸ’§ <strong>Water:</strong> Sacred waters of divine purification</li>
          <li>ğŸŒ <strong>Earth:</strong> Ancient divine foundation stone</li>
          <li>ğŸ’¨ <strong>Air:</strong> Celestial winds of the heavens</li>
          <li>âš¡ <strong>Lightning:</strong> Divine thunderbolt of the gods</li>
          <li>ğŸŒ¿ <strong>Nature:</strong> Sacred life force of creation</li>
          <li>ğŸ”® <strong>Magic:</strong> Pure divine essence and mystical power</li>
        </ul>
        
        <p><strong>ğŸ† Divine Scoring System:</strong></p>
        <ul>
          <li>ğŸ’ <strong>3-match:</strong> 50 divine points</li>
          <li>ğŸ’ <strong>4-match:</strong> 150 divine points for holy combinations</li>
          <li>ğŸ’ <strong>5+ match:</strong> 300+ divine points for sacred formations</li>
          <li>ğŸ”¥ <strong>Rush Multiplier:</strong> Each cascade increases your divine power</li>
          <li>ğŸ¯ <strong>Realm Targets:</strong> Reach the score goal to ascend divine realms</li>
        </ul>
        
        <p><strong>ğŸ•¹ï¸ Divine Controls:</strong></p>
        <ul>
          <li>ğŸ–±ï¸ <strong>Click to Select:</strong> Choose your divine gem</li>
          <li>ğŸ”„ <strong>Click to Swap:</strong> Unite adjacent divine powers</li>
          <li>ğŸ“± <strong>Swipe Gestures:</strong> Swipe to move gems on mobile</li>
          <li>âŒ <strong>Deselect:</strong> Click the same gem to cancel selection</li>
          <li>ğŸ”„ <strong>New Battle:</strong> Start fresh divine combat anytime</li>
        </ul>

        <p><strong>ğŸ… Achievements & Features:</strong></p>
        <ul>
          <li>ğŸ”¥ <strong>Streaks:</strong> Build consecutive match streaks for bonus points</li>
          <li>ğŸ’« <strong>Power-ups:</strong> Create special gems with 4+ matches</li>
          <li>ğŸ† <strong>Achievements:</strong> Unlock rewards for special accomplishments</li>
          <li>ğŸ“Š <strong>Statistics:</strong> Track your progress and improvement</li>
        </ul>
      </div>
      
      <!-- Settings Modal -->
      <div id="settingsModal" class="settings-modal" style="display: none;">
        <div class="settings-content">
          <div class="settings-header">
            <h2>âš™ï¸ Game Settings</h2>
            <button class="close-btn">âœ•</button>
          </div>
          
          <div class="settings-body">
            <!-- Audio Settings -->
            <div class="settings-section">
              <h3>ğŸ”Š Audio Settings</h3>
              <div class="setting-item">
                <label for="masterVolume">Master Volume</label>
                <input type="range" id="masterVolume" min="0" max="100" value="75" class="volume-slider">
                <span class="volume-value">75%</span>
              </div>
              <div class="setting-item">
                <label for="soundEffects">Sound Effects</label>
                <input type="checkbox" id="soundEffects" checked class="toggle-switch">
              </div>
              <div class="setting-item">
                <label for="backgroundMusic">Background Music</label>
                <input type="checkbox" id="backgroundMusic" checked class="toggle-switch">
              </div>
            </div>

            <!-- Visual Settings -->
            <div class="settings-section">
              <h3>ğŸ‘ï¸ Visual Settings</h3>
              <div class="setting-item">
                <label for="animations">Animations</label>
                <input type="checkbox" id="animations" checked class="toggle-switch">
              </div>
              <div class="setting-item">
                <label for="particleEffects">Particle Effects</label>
                <input type="checkbox" id="particleEffects" checked class="toggle-switch">
              </div>
              <div class="setting-item">
                <label for="highContrast">High Contrast Mode</label>
                <input type="checkbox" id="highContrast" class="toggle-switch">
              </div>
              <div class="setting-item">
                <label for="reducedMotion">Reduced Motion</label>
                <input type="checkbox" id="reducedMotion" class="toggle-switch">
              </div>
              <div class="setting-item">
                <label for="boardTheme">Board Theme</label>
                <select id="boardTheme" class="theme-select">
                  <option value="space">ğŸŒŒ Space (Default)</option>
                  <option value="forest">ğŸŒ² Forest</option>
                  <option value="ocean">ğŸŒŠ Ocean</option>
                  <option value="fire">ğŸ”¥ Fire</option>
                </select>
              </div>
            </div>

            <!-- Gameplay Settings -->
            <div class="settings-section">
              <h3>ğŸ® Gameplay Settings</h3>
              <div class="setting-item">
                <label for="difficulty">Difficulty Level</label>
                <select id="difficulty" class="difficulty-select">
                  <option value="easy">ğŸ˜Š Easy</option>
                  <option value="normal" selected>ğŸ˜ Normal</option>
                  <option value="hard">ğŸ˜¤ Hard</option>
                  <option value="expert">ğŸ”¥ Expert</option>
                </select>
              </div>
              <div class="setting-item">
                <label for="showHints">Show Hints</label>
                <input type="checkbox" id="showHints" checked class="toggle-switch">
              </div>
              <div class="setting-item">
                <label for="autoSave">Auto Save Progress</label>
                <input type="checkbox" id="autoSave" checked class="toggle-switch">
              </div>
              <div class="setting-item">
                <label for="showComboText">Show Combo Text</label>
                <input type="checkbox" id="showComboText" checked class="toggle-switch">
              </div>
            </div>

            <!-- Display Settings -->
            <div class="settings-section">
              <h3>ğŸ“± Display Settings</h3>
              <div class="setting-item">
                <label for="boardSize">Board Size</label>
                <select id="boardSize" class="size-select">
                  <option value="small">ğŸ“± Small (320px)</option>
                  <option value="medium">ğŸ“º Medium (400px)</option>
                  <option value="large" selected>ğŸ–¥ï¸ Large (480px)</option>
                  <option value="xlarge">ğŸ–¥ï¸ Extra Large (560px)</option>
                </select>
              </div>
              <div class="setting-item">
                <label for="fullscreen">Fullscreen Mode</label>
                <input type="checkbox" id="fullscreen" class="toggle-switch">
              </div>
              <div class="setting-item">
                <label for="showStats">Show Statistics</label>
                <input type="checkbox" id="showStats" checked class="toggle-switch">
              </div>
            </div>

            <!-- Controls Settings -->
            <div class="settings-section">
              <h3>ğŸ•¹ï¸ Controls Settings</h3>
              <div class="setting-item">
                <label for="keyboardShortcuts">Keyboard Shortcuts</label>
                <input type="checkbox" id="keyboardShortcuts" checked class="toggle-switch">
              </div>
              <div class="setting-item">
                <label for="clickFeedback">Click Feedback</label>
                <input type="checkbox" id="clickFeedback" checked class="toggle-switch">
              </div>
              <div class="setting-item">
                <label for="doubleClickSpeed">Double Click Speed</label>
                <input type="range" id="doubleClickSpeed" min="200" max="800" value="400" class="speed-slider">
                <span class="speed-value">Normal</span>
              </div>
            </div>
          </div>
          
          <div class="settings-footer">
            <button class="btn btn-secondary">
              ğŸ”„ Reset to Defaults
            </button>
            <button class="btn btn-primary">
              ğŸ’¾ Save Settings
            </button>
          </div>
        </div>
      </div>
    </div>
    </div>

    <!-- Main game script now loaded in head with defer -->
    
    <!-- Enhanced UI functions -->
    <script>
      function showInstructions() {
        const instructions = document.getElementById('instructions');
        if (instructions.style.display === 'none') {
          instructions.style.display = 'block';
          instructions.style.cssText = `
            display: block;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, rgba(26, 26, 58, 0.98), rgba(13, 13, 26, 0.95));
            border: 3px solid rgba(255, 255, 255, 0.4);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            color: #f0f0f0;
            box-shadow: 0 25px 50px rgba(0,0,0,0.7);
            backdrop-filter: blur(15px);
            z-index: 1000;
            text-align: left;
            font-family: Georgia, serif;
          `;
          
          // Add close button
          if (!instructions.querySelector('.close-btn')) {
            const closeBtn = document.createElement('button');
            closeBtn.className = 'close-btn';
            closeBtn.innerHTML = 'âœ•';
            closeBtn.style.cssText = `
              position: absolute;
              top: 15px;
              right: 20px;
              background: linear-gradient(145deg, #ff4757, #ff3742);
              border: none;
              color: white;
              font-size: 18px;
              cursor: pointer;
              padding: 8px 12px;
              border-radius: 50%;
              box-shadow: 0 4px 8px rgba(0,0,0,0.3);
              transition: all 0.3s ease;
            `;
            closeBtn.onmouseover = () => {
              closeBtn.style.transform = 'scale(1.1)';
              closeBtn.style.boxShadow = '0 6px 12px rgba(0,0,0,0.4)';
            };
            closeBtn.onmouseout = () => {
              closeBtn.style.transform = 'scale(1)';
              closeBtn.style.boxShadow = '0 4px 8px rgba(0,0,0,0.3)';
            };
            closeBtn.onclick = () => {
              instructions.style.display = 'none';
            };
            instructions.appendChild(closeBtn);
          }
        } else {
          instructions.style.display = 'none';
        }
      }
      
      // Close instructions when clicking outside
      document.addEventListener('click', function(event) {
        const instructions = document.getElementById('instructions');
        if (instructions.style.display === 'block' && 
          !instructions.contains(event.target) && 
          !event.target.classList.contains('btn-secondary')) {
          instructions.style.display = 'none';
        }
      });
      
      // Enhanced performance monitoring
      window.addEventListener('load', function() {
        const loadTime = performance.now();
        console.log(`âš¡ Gems Rush: Divine Teams loaded in ${loadTime.toFixed(2)}ms`);
        
        // Add loading animation fade out
        document.body.style.opacity = '0';
        document.body.style.transition = 'opacity 0.5s ease-in';
        setTimeout(() => {
          document.body.style.opacity = '1';
        }, 100);
      });
      
      // Keyboard shortcuts
      document.addEventListener('keydown', function(event) {
        if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') return;
        
        switch(event.key.toLowerCase()) {
          case 'r': if (typeof restartGame !== 'undefined') restartGame(); break;
          case 'h': showInstructions(); break;
        }
      });
    </script>
    
    <style>
      /* Enhanced instructions styling */
      .instructions h3 {
        color: #FFD700;
        margin-bottom: 20px;
        font-size: 1.4em;
        text-align: center;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
      }
      
      .instructions ul {
        margin: 15px 0;
        padding-left: 25px;
      }
      
      .instructions li {
        margin: 10px 0;
        line-height: 1.5;
        font-size: 14px;
      }
      
      .instructions p {
        margin: 15px 0;
        font-weight: bold;
        font-size: 16px;
      }
      
      .instructions p:nth-of-type(1) { color: #87CEEB; }
      .instructions p:nth-of-type(2) { color: #FF69B4; }
      .instructions p:nth-of-type(3) { color: #98FB98; }
      .instructions p:nth-of-type(4) { color: #DDA0DD; }
      
      /* Custom scrollbar for instructions */
      .instructions::-webkit-scrollbar {
        width: 8px;
      }
      
      .instructions::-webkit-scrollbar-track {
        background: rgba(255,255,255,0.1);
        border-radius: 4px;
      }
      
      .instructions::-webkit-scrollbar-thumb {
        background: linear-gradient(145deg, #667eea, #764ba2);
        border-radius: 4px;
      }
      
      .instructions::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(145deg, #764ba2, #667eea);
      }
    </style>

    <!-- Enhanced Main Menu Background Script -->
    <script>
      // Dynamic particle creation for main menu
      function createMenuParticles() {
        const particleField = document.querySelector('.particle-field');
        if (!particleField) return;

        // Create additional floating particles
        for (let i = 0; i < 15; i++) {
          const particle = document.createElement('div');
          particle.className = 'dynamic-particle';
          particle.style.cssText = `
            position: absolute;
            width: ${Math.random() * 4 + 2}px;
            height: ${Math.random() * 4 + 2}px;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.8), transparent);
            border-radius: 50%;
            top: ${Math.random() * 100}%;
            left: ${Math.random() * 100}%;
            animation: floatParticle ${8 + Math.random() * 4}s ease-in-out infinite;
            animation-delay: ${Math.random() * 3}s;
            pointer-events: none;
          `;
          particleField.appendChild(particle);
        }

        // Add CSS animation
        const style = document.createElement('style');
        style.textContent = `
          @keyframes floatParticle {
            0%, 100% { 
              transform: translateY(0px) translateX(0px) scale(1); 
              opacity: 0.3;
            }
            25% { 
              transform: translateY(-20px) translateX(10px) scale(1.2); 
              opacity: 0.8;
            }
            50% { 
              transform: translateY(-10px) translateX(-15px) scale(0.8); 
              opacity: 0.6;
            }
            75% { 
              transform: translateY(-30px) translateX(5px) scale(1.1); 
              opacity: 0.9;
            }
          }
          
          .dynamic-particle {
            filter: blur(0.5px);
          }
        `;
        document.head.appendChild(style);
      }

      // Initialize menu particles when main menu is visible
      document.addEventListener('DOMContentLoaded', function() {
        setTimeout(createMenuParticles, 500);
        
        // Add subtle mouse interaction to floating gems
        const floatingGems = document.querySelectorAll('.floating-gem');
        floatingGems.forEach(gem => {
          gem.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.2) rotate(15deg)';
            this.style.textShadow = `0 0 30px ${this.style.getPropertyValue('--color')}`;
          });
          
          gem.addEventListener('mouseleave', function() {
            this.style.transform = '';
            this.style.textShadow = `0 0 20px ${this.style.getPropertyValue('--color')}`;
          });
        });
        
        // Add click ripple effect to menu buttons
        const menuButtons = document.querySelectorAll('.menu-btn');
        menuButtons.forEach(button => {
          button.addEventListener('click', function(e) {
            const ripple = document.createElement('div');
            const rect = this.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;
            
            ripple.style.cssText = `
              position: absolute;
              width: ${size}px;
              height: ${size}px;
              left: ${x}px;
              top: ${y}px;
              background: radial-gradient(circle, rgba(255, 215, 0, 0.4), transparent);
              border-radius: 50%;
              transform: scale(0);
              animation: rippleEffect 0.6s ease-out;
              pointer-events: none;
              z-index: 0;
            `;
            
            this.appendChild(ripple);
            
            setTimeout(() => {
              if (ripple.parentNode) {
                ripple.parentNode.removeChild(ripple);
              }
            }, 600);
          });
        });
        
        // Add ripple CSS
        const rippleStyle = document.createElement('style');
        rippleStyle.textContent = `
          @keyframes rippleEffect {
            to {
              transform: scale(2);
              opacity: 0;
            }
          }
        `;
        document.head.appendChild(rippleStyle);
      });
    </script>
  </body>
</html> 